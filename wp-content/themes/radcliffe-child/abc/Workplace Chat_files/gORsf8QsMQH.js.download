if (self.CavalryLogger) { CavalryLogger.start_js(["0caFi"]); }

__d("FantaTypeFileUploaderFile",["immutable"],(function(a,b,c,d,e,f){"use strict";a={file:{},id:"",startTime:0,type:null,uploadedID:null};c=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(b("immutable").Record(a));e.exports=c}),null);
__d("MessengerDragAndDrop.react",["Bootloader","JSResource","MercuryShareAttachmentRenderLocations","MessengerEnvironment","React","lazyLoadComponent","prop-types","emptyFunction","ifRequired","setImmediate"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=144,h=b("lazyLoadComponent")(b("JSResource")("MercurySharePreview.react").__setRef("MessengerDragAndDrop.react"));a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){__p&&__p();var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$1=function(a){c.$4(function(b){b.removeSharePreview(a)})},c.$2=function(a,b){c.$4(function(c){c.loadedShareData(a,b)})},c.$3=function(a){c.$4(function(b){b.loadingShareData(a)})},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidMount=function(){b("MessengerEnvironment").messengerui?b("Bootloader").loadModules(["MessengerActions"],b("emptyFunction"),"MessengerDragAndDrop.react"):b("Bootloader").loadModules(["FantaMessageActions"],b("emptyFunction"),"MessengerDragAndDrop.react")};d.shouldComponentUpdate=function(a){var b=this.props;return b.threadID!==a.threadID||!!(!b.sharePreview&&a.sharePreview)||!!(b.sharePreview&&a.sharePreview&&!b.sharePreview.equals(a.sharePreview))};d.render=function(){var a=this.props,c=a.sharePreview;a=a.threadID;c=c||{};var d=c.share;c=c.uri;return d||c?b("React").jsx("div",{className:"fbNubFlyoutAttachments",children:b("React").jsx("div",{className:"chatAttachmentShelf",children:b("React").jsx(b("React").Suspense,{fallback:b("React").jsx("div",{}),children:b("React").jsx(h,{onClose:this.$1,onLoaded:this.$2,onLoading:this.$3,threadID:a,imageSize:{width:g,height:g},location:b("MercuryShareAttachmentRenderLocations").CHAT_PREVIEW,share:d,uri:c})})})}):null};d.$4=function(a){__p&&__p();var c=this;b("setImmediate")(function(){typeof c.props.onResize==="function"&&c.props.onResize()});b("MessengerEnvironment").messengerui?b("ifRequired")("MessengerActions",function(b){a(b)},function(){b("Bootloader").loadModules(["MessengerActions"],function(b){a(b)},"MessengerDragAndDrop.react")}):b("ifRequired")("FantaMessageActions",function(b){a(b)},function(){b("Bootloader").loadModules(["FantaMessageActions"],function(b){a(b)},"MessengerDragAndDrop.react")})};return c}(b("React").Component);a.propTypes={threadID:b("prop-types").string.isRequired};e.exports=a}),null);
__d("MessengerSharePreviewStore",["FantaTypeSharePreview","MessengerActions","MessengerStore","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var c;c=a.call(this)||this;c.$MessengerSharePreviewStore1=b("immutable").Map({});return c}var d=c.prototype;d.getState=function(){return this.$MessengerSharePreviewStore1};d.__onDispatch=function(a){__p&&__p();var c=a.threadID;switch(a.type){case b("MessengerActions").Types.LINK_PREVIEW:var d=a.match;this.$MessengerSharePreviewStore1=this.$MessengerSharePreviewStore1.withMutations(function(a){a.get(c)||a.set(c,new(b("FantaTypeSharePreview"))());var e=a.get(c);a.set(c,e.merge({params:null,type:null,uri:d}))});this.emitChange();break;case b("MessengerActions").Types.LOADING_SHARE_DATA:this.$MessengerSharePreviewStore1=this.$MessengerSharePreviewStore1.withMutations(function(a){var b=a.get(c);if(!b)return;a.set(c,b.merge({isLoading:!0,params:null,type:null}))});this.emitChange();break;case b("MessengerActions").Types.LOADED_SHARE_DATA:a=a.attachmentData;var e=a.share_data;this.$MessengerSharePreviewStore1=this.$MessengerSharePreviewStore1.withMutations(function(a){var d=a.get(c);if(!d)return;a.set(c,d.merge({isLoading:!1,params:b("immutable").Map({data:e.share_params}),type:e.share_type}))});this.emitChange();break;case b("MessengerActions").Types.REMOVE_SHARE_PREVIEW:this.$MessengerSharePreviewStore1=this.$MessengerSharePreviewStore1.withMutations(function(a){a.get(c)&&a.set(c,new(b("FantaTypeSharePreview"))())});this.emitChange();break}};return c}(b("MessengerStore"));e.exports=new a()}),null);
__d("MessengerUploadFilesStore",["fbt","ChatFileUploadLoggingUtils","Dialog","FantaTypeFileUploader","FantaTypeFileUploaderFile","FBLogger","LogHistory","MercuryConstants","MercuryExperimentUtils","MessengerActions","MessengerStore","PhotosUploadID","gkx","immutable"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("LogHistory").getInstance("messenger_share_file_preview");a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var c;c=a.call(this)||this;c.$MessengerUploadFilesStore1=b("immutable").Map({});return c}var d=c.prototype;d.getState=function(){return this.$MessengerUploadFilesStore1};d.__onDispatch=function(a){__p&&__p();var c,d=a.threadID,e=a.uploadID;switch(a.type){case b("MessengerActions").Types.PREPARE_FILES_FOR_SEND:h.log("Add files "+d,JSON.stringify(a));var f=a.files;this.$MessengerUploadFilesStore1=j(this.$MessengerUploadFilesStore1,d,f);this.emitChange();break;case b("MessengerActions").Types.CANCEL_FILE_UPLOAD:h.debug("Remove file "+d,JSON.stringify(a));f=this.$MessengerUploadFilesStore1.get(d);c=f.get("uploadingFiles").get(e);c?this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.deleteIn([d,"uploadingFiles",e]):(c=f.get("uploadedFiles").get(e),c&&(this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.deleteIn([d,"uploadedFiles",e])));this.emitChange();break;case b("MessengerActions").Types.EMPTY_FILES:h.debug("Empty files "+d,JSON.stringify(a));this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.withMutations(function(a){a.get(d)&&a.set(d,new(b("FantaTypeFileUploader"))())});this.emitChange();break}};return c}(b("MessengerStore"));function i(a,c){new(b("Dialog"))().setTitle(a).setBody(c).setButtons(b("Dialog").OK).setSemiModal(!0).show()}function j(a,c,d){__p&&__p();if(d.length>b("MercuryConstants").attachmentMaxLimit){i(g._("B\u1ea1n \u0111\u00e3 ch\u1ecdn qu\u00e1 nhi\u1ec1u file.").toString(),g._("B\u1ea1n c\u00f3 th\u1ec3 g\u1eedi t\u1ed1i \u0111a {max number of files} file.",[g._param("max number of files",b("MercuryConstants").AttachmentMaxLimit)]).toString());b("FBLogger")("messenger_upload_file").warn("Attachment limit reached");return a}for(var e=0;e<d.length;e++){var f=d[e];b("ChatFileUploadLoggingUtils").log(f);if(f.size>b("MercuryConstants").AttachmentMaxSize){f=b("MercuryExperimentUtils").getMaxAttachmentSizeExceededDialog();i(g._("File m\u00e0 b\u1ea1n \u0111\u00e3 ch\u1ecdn qu\u00e1 l\u1edbn").toString(),b("gkx")("1147754")?g._("File b\u1ea1n ch\u1ecdn qu\u00e1 l\u1edbn. K\u00edch th\u01b0\u1edbc t\u1ed1i \u0111a l\u00e0 100 MB").toString():f);b("FBLogger")("messenger_upload_file").warn("Uploading file is too large");return a}}for(var f=0;f<d.length;f++){e=d[f];var h=l();a=k(a,c,h,e)}return a}function k(a,c,d,e){return a.withMutations(function(a){a.get(c)||a.set(c,new(b("FantaTypeFileUploader"))());var f=a.get(c);a.set(c,f.setIn(["uploadedFiles",d],new(b("FantaTypeFileUploaderFile"))({file:e,id:d,startTime:Date.now()})))})}function l(){return"upload_"+b("PhotosUploadID").getNewID()}e.exports=new a()}),null);
__d("MessengerSecondarySearchFunnelLogger",["FunnelLogger","MercuryConfig","MessengerSecondarySearchFunnelConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=(g=b("MessengerSecondarySearchFunnelConstants")).FUNNEL_NAME,i=g.ENTRY_SURFACES,j=g.EVENTS,k=g.SEARCH_SURFACES,l=g.MICRO_SESSION_TYPES,m=g.END_ACTIONS,n=new Map(),o=new Map(),p=new Map(),q=new Map(),r=0;function a(a,c,d,e,f){if(!f)return;b("FunnelLogger").startFunnel(h,f);b("FunnelLogger").setFunnelTimeout(h,86400);p.set(f.toString(),c);b("FunnelLogger").appendActionWithPayloadIfNew(h,f,j.START,{search_surface:c,entry_surface:d,thread_fbid:e,client:a});(b("MercuryConfig").ChatComposer||c!==k.OMNIPICKER)&&w(f)}function c(a,c,d,e,f){if(!d)return;var g=o.get(d.toString()),i=n.get(d.toString());i=i?l.QUERY:l.NO_QUERY;g!==null&&(x(d,i),p["delete"](d.toString()));b("FunnelLogger").appendActionWithPayloadIfNew(h,d,j.END,{end_reason:a,action_name:c,thread_fbid:e,is_new_thread:f});b("FunnelLogger").endFunnel(h,d)}function d(a,c){if(!c)return;var d=c.toString(),e=n.get(d),f=p.get(d);!e&&!!a?((b("MercuryConfig").ChatComposer||f===k.BROADCAST||f===k.GROUP_CREATION||f===i.COMPOSER)&&x(c,l.NO_QUERY),w(c)):e&&a===""&&e!==""&&(x(c,l.QUERY),(b("MercuryConfig").ChatComposer||f===k.BROADCAST||f===k.GROUP_CREATION||f===i.COMPOSER)&&w(c));n.set(d,a);b("FunnelLogger").appendActionWithPayload(h,c,j.QUERY_CHANGED,{query_string:a})}function f(a,c,d,e,f,g,i,m){if(!i)return;var r=i.toString(),s=p.get(r),t=o.get(r);q.set(t,!0);b("FunnelLogger").appendActionWithPayload(h,i,j.RESULT_SELECTED,{query_string:e,result_fbid:a,result_type:d,result_index:c,data_source:[f],search_surface:g,micro_session_id:t,selection_type:m});s===k.OMNIPICKER?(x(i,l.QUERY),b("MercuryConfig").ChatComposer?(n.set(r,""),w(i)):n["delete"](r)):e&&s===k.GROUP_CREATION&&(n.set(r,""),x(i,l.QUERY),w(i))}function s(a,c,d){if(!d)return;b("FunnelLogger").appendActionWithPayload(h,d,j.SOURCE_STARTED,{query_string:a,data_source:[c]})}function t(a,c,d,e,f,g){if(!g)return;b("FunnelLogger").appendActionWithPayload(h,g,j.SOURCE_ENDED,{query_string:a,results_count:c,data_source:[d],status:e,result_used:f})}function u(a,c,d,e){if(!e)return;if(c.length===0)return;b("FunnelLogger").appendActionWithPayload(h,e,j.IMPRESSIONS,{query_string:a,impression_list:c})}function v(a,c,d){if(!d)return;b("FunnelLogger").appendActionWithPayload(h,d,j.TOKEN_REMOVED,{deleted_result_id:a,cleared_all_tokens:c})}function w(a){b("FunnelLogger").appendActionWithPayload(h,a,j.MICRO_SESSION_STARTED,{micro_session_id:r}),o.set(a.toString(),r),q.set(r,!1),r+=1}function x(a,c){var d=o.get(a.toString());b("FunnelLogger").appendActionWithPayload(h,a,j.MICRO_SESSION_ENDED,{micro_session_id:d,micro_session_end_reason:q.get(d)?m.RESULT_SELECTED:m.ABANDON,micro_session_type:c});q["delete"](d);o["delete"](a.toString())}function y(a){b("FunnelLogger").appendAction(h,a,j.REENTER_OMNIPICKER)}function z(a){b("FunnelLogger").appendAction(h,a,j.CLICK_OTHER_THREAD)}e.exports={endFunnel:c,impressions:u,queryChanged:d,reenterSearch:y,resultSelected:f,sourceEnded:t,sourceStarted:s,startFunnel:a,tokenRemoved:v,unfocusSearch:z}}),null);