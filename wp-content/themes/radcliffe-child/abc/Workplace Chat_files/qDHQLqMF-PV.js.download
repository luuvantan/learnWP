if (self.CavalryLogger) { CavalryLogger.start_js(["u2dni"]); }

__d("XMapsProviderByViewPortController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/maps/provider_by_viewport/",{swlat:{type:"Float",required:!0},swlon:{type:"Float",required:!0},nelat:{type:"Float",required:!0},nelon:{type:"Float",required:!0},zoom:{type:"Float",required:!0},v:{type:"Int"}})}),null);
__d("TilesMapUtils",["CurrentLocale","GeoCoordinates","LeafletView","TilesMapConfig","XAsyncRequest","XMapsProviderByViewPortController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={DEFAULT_VIEW:new(b("LeafletView"))({center:new(b("GeoCoordinates"))(0,0),zoom:b("TilesMapConfig").ZOOM_RANGE.MIN}),getMapProviderForAttributionByViewPort:function(a,c,d){a=b("XMapsProviderByViewPortController").getURIBuilder().setFloat("swlat",a.getSouth()).setFloat("swlon",a.getWest()).setFloat("nelat",a.getNorth()).setFloat("nelon",a.getEast()).setFloat("zoom",c).setInt("v",b("TilesMapConfig").VERSION).getURI();c=new(b("XAsyncRequest"))(a).setHandler(function(a){return d(a.payload)});c.setAllowCrossPageTransition&&c.setAllowCrossPageTransition(!0);return c.send()},getTileURLTemplate:function(a,c){a||(a=b("CurrentLocale").get());return b("TilesMapConfig").TILE_URL_TEMPLATE+"&language="+a+(c&&c!=="default"?"&theme="+c:"")+(c==="live_maps"?"&lmv="+b("TilesMapConfig").LIVE_MAP_VERSION:"")},getMapProviderForAttribution:function(a){return a.height<b("TilesMapConfig").MIN_SIZE_FOR_ATTRIBUTION||a.width<b("TilesMapConfig").MIN_SIZE_FOR_ATTRIBUTION?null:"OSM"}};e.exports=a}),null);
__d("TilesDynamicMap__DEPRECATED",["csx","Arbiter","ArbiterMixin","CSS","DataStore","DOM","FBMapInfoButton.react","Parent","React","ReactDOM","Run","TilesMapUtils","leaflet","mixin","mod"],(function(a,b,c,d,e,f,g){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f,g){__p&&__p();var h;h=a.call(this)||this;h.$TilesDynamicMap4=null;h.theme=d.theme;h.map=b("leaflet").map(c,{center:[d.latitude,d.longitude],zoom:d.zoom||1,layers:[b("leaflet").tileLayer(d.urlTemplate||b("TilesMapUtils").getTileURLTemplate(d.language,d.theme),{minZoom:d.minZoom||1,maxZoom:d.maxZoom||18})],zoomControl:d.zoomControl,scrollWheelZoom:d.zoomOnScroll,touchZoom:d.enableZoom,doubleClickZoom:d.enableZoom,boxZoom:d.enableZoom,keyboardZoomOffset:d.enableZoom?1:0,attributionControl:!1,dragging:d.dragging,fadeAnimation:d.enableFadeAnimation}).on({click:function(a){this.inform("DynamicMap/mapClick",{lat:a.latlng.lat,lng:a.latlng.lng},"persistent")}.bind(babelHelpers.assertThisInitialized(h))});d.zoomOnScroll&&b("Run").onLeave(function(){h.map.scrollWheelZoom.removeHooks()});var i=[],j=function(a){d=e[a],l=b("leaflet").icon({iconUrl:d.iconUrl,iconRetinaUrl:d.iconRetinaUrl,iconSize:d.iconSize,iconAnchor:d.iconAnchor,popupAnchor:d.popupAnchor}),m=b("leaflet").marker([d.latitude,d.longitude],{draggable:d.draggable,icon:l}).on({drag:function(c){c=c.target.getLatLng();b("Arbiter").inform("DynamicMap/pinDrag",{pin_id:a,latitude:c.lat,longitude:c.lng},"persistent")},dragend:function(c){c=c.target.getLatLng();b("Arbiter").inform("DynamicMap/pinDragEnd",{pin_id:a,latitude:c.lat,longitude:c.lng},"persistent")}}),i.push(m),d.popupContent!=null&&(n={},d.popupMaxWidth!=null&&(n.maxWidth=d.popupMaxWidth),d.popupMaxHeight!=null&&(n.maxHeight=d.popupMaxHeight),m.bindPopup(b("leaflet").popup(n).setContent(d.popupContent))),m.addTo(h.map)};for(var k=0;k<e.length;k++){var l,m,n;j(k)}h.markers=i;h.polys={};for(var k=0;k<f.length;k++){j=f[k].points.map(function(a){return[parseFloat(a.latitude),parseFloat(a.longitude)]});var o={stroke:f[k].weight>0,weight:f[k].weight,color:f[k].color,opacity:f[k].opacity,fillColor:f[k].fillColor,fillOpacity:f[k].fillOpacity},p=null;if(f[k].type=="polyline")p=b("leaflet").polyline(j,o);else if(f[k].type=="polygon"){j=[j];for(var q=0;q<f[k].innerRings.length;q++)j.push(f[k].innerRings[q].map(function(a){return[parseFloat(a.latitude),parseFloat(a.longitude)]}));p=b("leaflet").polygon(j,o)}if(f[k].activeFillColor){var r=f[k].fillColor,s=f[k].fillOpacity,t=f[k].activeFillColor,u=f[k].activeFillOpacity;p.on({mouseover:function(a){a.target.setStyle({fillColor:t,fillOpacity:u})}.bind(babelHelpers.assertThisInitialized(h)),mouseout:function(a){a.target.setStyle({fillColor:r,fillOpacity:s})}.bind(babelHelpers.assertThisInitialized(h))})}"id"in f[k]&&(p.id=f[k].id,h.polys[p.id]=p);p.on({mouseover:function(a){this.inform("DynamicMap/polyMouseOver",{target:a.target},"persistent")}.bind(babelHelpers.assertThisInitialized(h)),mouseout:function(a){this.inform("DynamicMap/polyMouseOut",{target:a.target},"persistent")}.bind(babelHelpers.assertThisInitialized(h)),click:function(a){this.inform("DynamicMap/polyClick",{target:a.target},"persistent")}.bind(babelHelpers.assertThisInitialized(h))});f[k].href&&(p.href=f[k].href,p.on({click:function(a){window.open(a.target.href)}}));f[k].popupContent!==null&&p.bindPopup(b("leaflet").popup({}).setContent(f[k].popupContent));p.addTo(h.map)}h.circles={};for(var q=0;q<g.length;q++){j=b("leaflet").circle([g[q].latitude,g[q].longitude],g[q].radius,{color:g[q].color,weight:g[q].weight,opacity:g[q].opacity,fillColor:g[q].fillColor,fillOpacity:g[q].fillOpacity}).addTo(h.map);o="id"in g[q]?"id:"+g[q].id:q;j.id=g[q].id;j.on({mouseover:function(a){this.inform("DynamicMap/circleMouseOver",{target:a.target},"persistent")}.bind(babelHelpers.assertThisInitialized(h)),mouseout:function(a){this.inform("DynamicMap/circleMouseOut",{target:a.target},"persistent")}.bind(babelHelpers.assertThisInitialized(h)),click:function(a){this.inform("DynamicMap/circleClick",{target:a.target},"persistent")}.bind(babelHelpers.assertThisInitialized(h))});g[q].href&&(j.href=g[q].href,j.on({click:function(a){window.open(a.target.href)}}));h.circles[o]=j}h.subscribe("DynamicMap/setRadius",function(a,b){a=this.getCircleByIdOrOnly(b.id);a&&(a.setRadius(b.radius),b.center&&this.map.fitBounds(a.getBounds()))}.bind(babelHelpers.assertThisInitialized(h)));h.subscribe("DynamicMap/toggleCircle",function(a,c){a=this.getCircleByIdOrOnly(c.id);a&&b("CSS").toggle(a.getPath())}.bind(babelHelpers.assertThisInitialized(h)));h.subscribe("DynamicMap/setCircleLatLng",function(a,b){a=this.getCircleByIdOrOnly(b.id);a&&this.updateObjectLatLng(a,b.lat,b.lng)}.bind(babelHelpers.assertThisInitialized(h)));h.subscribe("DynamicMap/setPinLatLng",function(a,b){a=this.getMarkerByIdOrOnly(b.id);a&&this.updateObjectLatLng(a,b.lat,b.lng)}.bind(babelHelpers.assertThisInitialized(h)));p=b("leaflet").Control.extend({onAdd:function(a){return b("leaflet").DomUtil.create("div",null,this.$TilesDynamicMap1)}});k=new p();h.map.addControl(k);f=document.createElement("span");c.appendChild(f);h.$TilesDynamicMap2(f);b("DataStore").set(c,"TilesDynamicMap",babelHelpers.assertThisInitialized(h));h.inform("DynamicMap/onInit",{},"persistent");return h}var d=c.prototype;d.on=function(a,b,c){return this.map.on(a,b,c)};d.off=function(a,b,c){return this.map.off(a,b,c)};d.fitBounds=function(a){this.map.fitBounds(a)};d.getCenter=function(){var a=this.map.getCenter();return{latitude:a.lat,longitude:a.lng}};d.getZoom=function(){return this.map.getZoom()};d.setZoom=function(a){this.setView({center:this.map.getCenter(),zoom:a,animate:!1})};d.getWidth=function(){return this.map.getSize().x};d.getHeight=function(){return this.map.getSize().y};d.invalidateSize=function(){this.map.invalidateSize(!1)};d.setView=function(a){if(a.centerOffset){var b=this.map.project(a.center,a.zoom);b=b.subtract(a.centerOffset);a.center=this.map.unproject(b,a.zoom)}this.map.setView(a.center,a.zoom,{animate:a.animate});this.map.fireEvent("movestart");this.map.fireEvent("moveend")};d.poly=function(a){return this.polys[a]};d.onInit=function(a){a()};d.getMap=function(){return this};d.getBounds=function(){return this.map.getBounds()};d.mapToPixel=function(a){var b=this.map.getPixelBounds().min;return a.sub(b.x,b.y)};d.pixelToMap=function(a){var c=this.map.getPixelBounds().min;a=a.add(c.x,c.y);a.x=b("mod")(a.x,this.$TilesDynamicMap3());return a};d.tryPixelToLocation=function(a){return this.map.containerPointToLatLng(a)};d.getCircleByIdOrOnly=function(a){if(a)return this.circles["id:"+a];else{a=Object.keys(this.circles);if(a.length==1)return this.circles[a[0]]}return null};d.getMarkerByIdOrOnly=function(a){if(a!=null)return this.markers[a];else if(this.markers.length===1)return this.markers[0];return null};d.updateObjectLatLng=function(a,c,d){var e=a.getLatLng();c=c||e.lat;d=d||e.lng;a.setLatLng(b("leaflet").latLng(c,d))};d.$TilesDynamicMap3=function(){return 512*Math.pow(2,this.map.getZoom()-1)};d.componentWillUnmount=function(){this.$TilesDynamicMap4&&this.$TilesDynamicMap4.abort()};d.$TilesDynamicMap2=function(a){a=b("leaflet").Control.extend({options:{position:"bottomright"},infoButton:a,initialize:function(a){b("leaflet").Util.setOptions(this,a)},onAdd:function(a){var c=function(){return{mapUrl:null,mapBounds:a.getBounds(),zoom:a.getZoom()}};b("ReactDOM").render(b("React").jsx(b("FBMapInfoButton.react"),{fetchMapInfo:c}),this.infoButton);return this.infoButton}});a=new a();this.map.addControl(a)};c.getInstance=function(a){var c=b("Parent").bySelector(a,"._49nx");if(!c){a=b("DOM").scry(a,"._49nx");c=a.length>0?a[0]:null}return c?b("DataStore").get(c,"TilesDynamicMap"):null};c.poke=function(a){a=c.getInstance(a);a&&a.invalidateSize()};return c}(b("mixin")(b("ArbiterMixin")));e.exports=a}),null);