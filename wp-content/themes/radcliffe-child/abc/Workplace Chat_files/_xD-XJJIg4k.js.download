if (self.CavalryLogger) { CavalryLogger.start_js(["v6k3m"]); }

__d("updatePhotoProgressBar",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b){if(b.carousel_uploading)if(b.skip_upload)a.setPosition(50),a.setTarget(100,1e3);else{var c=b.loaded/b.total*100;a.setPosition(c)}else b.loaded!=b.total?a.setPosition(50*b.loaded/b.total):(a.setPosition(50),a.setTarget(100,2e3))}e.exports=a}),null);
__d("PhotosMultiUploadInput",["csx","cx","fbt","Animation","Arbiter","AsyncUploadRequest","Bootloader","ComposerXController","ComposerXDragDropUtils","ComposerXMarauderLogger","ComposerXMediaUploadHandler","CSS","Dialog","DOM","DragDropTarget","Event","JpegResizer","OptimisticVideoPostUtils","Parent","PhotosMimeType","PhotosUploadID","PhotosUploadWaterfallXMixin","ProgressBar","PUWMethods","ReactComposerMediaUtils","Tooltip","VideoUploadFile","WaterfallIDGenerator","XComposerPhotoUploader","$","mixin","performanceNow","updatePhotoProgressBar"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j,k=1366052;a=function(){"use strict";__p&&__p();function a(a,c,d,e){this._grid=n.getInstance(e.gridID),this._grid.setProgressBarMarkup(a).setVideoIconMarkup(c).setConfig(e),d.getInput().multiple=e.maxselect!=1&&b("AsyncUploadRequest").isSupported(),d.subscribe("change",function(a,b){b.getTarget().value&&this._grid.doFileUpload(d)}.bind(this)),this._grid.sessionStarted||(this._grid.sessionStarted=!0,this._grid.logStep("client_flow_begin",{custom_tags:{high_quality:e.initWithHighQuality}})),this._grid.logStep("client_select_begin"),b("Arbiter").inform("PhotosMultiUploadInput/loaded/"+e.gridID,null,"persistent")}var c=a.prototype;c.getGrid=function(){return this._grid};c.onQualitySettingChanged=function(a){this._grid.setQuality(a)};return a}();Object.assign(a,{imageUploadDone:function(a,b,c,d,e){l[a].imageUploadDone(b,c,d,e)},addCameraImage:function(a,b,c){l[a].addCameraImage(b,c)},initDragDrop:function(a,c){b("Arbiter").inform("PhotosMultiUploadInput/initDragDrop/"+a,{dragDropArea:c},"persistent")},imageUploadFail:function(a,b){l[a].removeLoadingIndicator(b.getFile().uploadID)},doFileUpload:function(a,b){l[a].doFileUpload(b)},onFilesDrop:function(a,b){l[a].onFilesDrop(b)},onVaultImagesAdded:function(a,b){l[a].onVaultImagesAdded(b)},getWaterfallID:function(a){return n.getInstance(a).getWaterfallID()},clearSession:function(a){l[a].clearSession()},getConfig:function(a){return l[a].getConfig()}});var l={},m=0,n=function(c){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,c);function a(a){__p&&__p();var d;d=c.call(this)||this;d._loadingIndicators={};d._numRemainingFiles=0;d._progressBarMarkup=null;d._videoIconMarkup=null;d._gridID=a;d._dragDropTarget=null;d._submitListener=null;d._fileInputInstances=[];d._uploadTimers={};d._videoEncodeTimers={};d._sessionsStarted=!1;d._waterfallID=null;d._resizer=null;d._numUploadsSucceeded=0;d._numUploadsFailed=0;d._uploadIDToFileUpload={};d._failedUploadIDs={};d._uploadIDToChildIndex={};d._uploadParams=[];b("Arbiter").subscribe("multi-upload/video-removed/"+d._gridID,function(){b("DOM").remove(this._videoIconMarkup),this._submitListener&&this._submitListener.remove(),this._submitListener=null,this._fileInputInstances.forEach(function(a){a.clear()})}.bind(babelHelpers.assertThisInitialized(d)));b("Arbiter").subscribe("multi-upload/image-removed/"+d._gridID,function(){d._logComposerWaterfallEvent("remove_photo")});b("Arbiter").subscribe("PhotosMultiUploadInput/initDragDrop/"+d._gridID,function(a,b){d.initDragDrop(b.dragDropArea)});b("Arbiter").subscribe("AttachmentsPhotoEditor/logPhotoEditorLaunched"+d._gridID,function(a,b){d.logStep("client_photo_edit_begin")});b("Arbiter").subscribe("AttachmentsPhotoEditor/newImage"+d._gridID,d._onEditedImage.bind(babelHelpers.assertThisInitialized(d)));return d}var d=a.prototype;d.getWaterfallID=function(){this._waterfallID||(this._waterfallID=b("WaterfallIDGenerator").generate());return this._waterfallID};d.getWaterfallAppName=function(){return"web_composer"};d.getWaterfallSource=function(){return this._config.ref};d.getLoadingIndicator=function(a){a=this._loadingIndicators[a];return a};d.initDragDrop=function(a){var c=this;this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new(b("DragDropTarget"))(a).setOnFilesDropCallback(function(a){c.onFilesDrop(a,"dragdrop")}).setFileFilter(b("ComposerXDragDropUtils").filterImages).enable()};d.setConfig=function(a){this._config=a;this._isHighQuality=Object.prototype.hasOwnProperty.call(a,"initWithHighQuality")?a.initWithHighQuality:!0;!b("JpegResizer").isSupported()?this.logStep("client_process_unavailable"):this._config.useResizer&&(this._resizer=new(b("JpegResizer"))(this._config.maxselect===1?1:b("JpegResizer").DEFAULT_POOL_SIZE),this._resizer.setHighQuality(this._isHighQuality));this._waterfallID||(this._waterfallID=a.waterfallID);this._concurrentLimit=a.concurrentLimit;return this};d.setProgressBarMarkup=function(a){this._progressBarMarkup=a;return this};d.setVideoIconMarkup=function(a){this._videoIconMarkup=a;a=b("DOM").find(a,"._3ev");b("Event").listen(a,"click",this._onVideoRemoved.bind(this));return this};d.setQuality=function(a){this._isHighQuality=a,this._resizer&&this._resizer.setHighQuality(a),this.logStep("client_quality_switch",{custom_tags:{high_quality:this._isHighQuality}})};d.imageUploadDone=function(a,c,d,e){__p&&__p();this._numUploadsSucceeded++;var f=this.getLoadingIndicator(c);if(!f)return;b("DOM").contains(document.body,f.getRoot())&&b("DOM").replace(f.getRoot(),a);f={};f[c]=d;if(this._config.isVideoCarouselPost){this._markUploadAsFinished();a={};a.image_fbid=d;this._uploadParams[this._uploadIDToChildIndex[c]]=a;this._isUploadFinished()&&this._informUploadFinished()}else this._informImagesAdded(f,e),this._markUploadAsFinished();this._loadingIndicators[c]=null};d.addCameraImage=function(a,b){this.insertIntoGrid(a),this._informImagesAdded({0:b},{}),this.logStep("client_attach_photo",{method:"camera",fbid:b})};d._informImagesAdded=function(a,c){b("Arbiter").inform(["multi-upload/images-added/"+this._gridID,"multi-upload/images-added"],{fbids:a,tagInfo:{exifLocation:c}}),b("Arbiter").inform("composer/updateViewerLocationEstimate",c)};d._informUploadFinished=function(){b("Arbiter").inform(["multi-upload/medias-added/"+this._gridID],{params:this._uploadParams})};d._generateLoadingIndicatorForPhoto=function(a){this._generateLoadingIndicator(a.uploadID),this._uploadIDToChildIndex[a.uploadID]=this._uploadParams.length,this._uploadParams[this._uploadParams.length]={}};d._generateLoadingIndicator=function(a){this._numRemainingFiles++;var c=this._progressBarMarkup.cloneNode(!0);b("Event").listen(c,"click",this._clickHandler.bind(this,a));this.insertIntoGrid(c);this._loadingIndicators[a]=new(b("ProgressBar"))(c)};d._generateUploadIDsAndLoadingIndicators=function(a){for(var c=0;c<a.length;c++)a[c].uploadID||(a[c].uploadID=b("PhotosUploadID").getNewID()),this._generateLoadingIndicator(a[c].uploadID)};d._clickHandler=function(a,c){c=c.target;var d="_639";b("Parent").byClass(c,d)&&(this._failedUploadIDs[a]?this.removeLoadingIndicator(a):this.fileUploadCanceled(a,this._uploadIDToFileUpload[a]));d="_2zo7";b("Parent").byClass(c,d)&&(b("CSS").hide(b("DOM").find(this.getLoadingIndicator(a).getRoot(),"._2zo5")),this._retryFileUpload(this._uploadIDToFileUpload[a].getFile()),this._failedUploadIDs[a]=!1);d="_2zo8";b("Parent").byClass(c,d)&&this.removeLoadingIndicator(a)};d.fileUploadFailure=function(a,b,c){__p&&__p();this._numUploadsFailed++;this._failedUploadIDs[a]=!0;var d=Date.now()-this._uploadTimers[a],e=0;b.upload&&(e=b.upload.getRetryCount?b.upload.getRetryCount():0);var f=b.response.getErrorDescription(),g=b.response.getError();g===k&&(f=JSON.stringify(c));this.logStep("client_transfer_fail",{dt:d,error_code:g,error_info:f,bytes:b.upload.getFile().size,auto_retry_count:e,custom_tags:{high_quality:this._isHighQuality,manual_retry:!!b.upload.getFile().manuallyRetried}});if(this._config.useNewErrorUI){c=b.response.isTransient()||b.response.getError()==1004||b.response.getError()==1006;d=c&&this._uploadIDToFileUpload[a];this._showNewUploadFailedMessage(a,b.upload.getFile().name||b.upload.getFile().filename||"",b.response.getErrorSummary(),b.response.getErrorDescription(),d,b.upload.getFile());this._markUploadAsFinished()}else this._showUploadFailedMessage(a),this._fadeOutFileUpload(a)};d._fadeOutFileUpload=function(a){new(b("Animation"))(this.getLoadingIndicator(a).getRoot()).duration(2e3).checkpoint().from("opacity",1).to("opacity",0).duration(1e3).ondone(this.removeFileUpload.bind(this,a)).go()};d._showUploadFailedMessage=function(a){b("CSS").hide(b("DOM").find(this.getLoadingIndicator(a).getRoot(),"._5l83")),b("CSS").show(b("DOM").find(this.getLoadingIndicator(a).getRoot(),"._5l82"))};d._showNewUploadFailedMessage=function(a,c,d,e,f,g){__p&&__p();g=this.getLoadingIndicator(a).getRoot();b("CSS").hide((a=b("DOM")).find(g,"._5l83"));b("CSS").show(a.find(g,"._2zo5"));var h=a.find(g,"._2zo6");a.setContent(h,c);h=a.find(g,"._2zo5");b("Tooltip").set(h,d+": "+e);if(f){c=b("DOM").find(g,"._2zo7");b("CSS").show(c)}else{a=b("DOM").find(g,"._2zo8");b("CSS").show(a)}};d._finishUploadBatch=function(){b("Arbiter").inform("multi-upload/images-upload-completed/"+this._gridID),this._numUploadsFailed>0?this.logStep("client_transfer_batch_fail",{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed}):this.logStep("client_transfer_batch_success",{volume:this._numUploadsSucceeded}),this._numUploadsSucceeded=0,this._numUploadsFailed=0};d.fileUploadCanceled=function(a,b){b&&b.abort();var c={latency:Date.now()-this._uploadTimers[a]};b&&b.getFile()&&(c.bytes=b.getFile().size);this.logStep("client_transfer_cancel",c);this.removeFileUpload(a)};d.removeFileUpload=function(a){this.removeLoadingIndicator(a),this._markUploadAsFinished()};d._markUploadAsFinished=function(){this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1),this._numRemainingFiles===0&&this._finishUploadBatch()};d.getVideoOrPhotoUploadCallback=function(a,c){__p&&__p();var d=this;return function(e){__p&&__p();if(e)for(var e=0;e<a.input.files.length;e++){var f=b("ReactComposerMediaUtils").getVideoUploader(d._config.composerID),g=a.input.files[e];g.uploadID||(g.uploadID=b("PhotosUploadID").getNewID());var h=b("VideoUploadFile").fromFile(g);f.subscribe("upload-started",d._onVideoUploadStart.bind(d,g));f.subscribe("upload-progressed",d._onVideoUploadProgress.bind(d,g));f.subscribe("upload-finished",d._onVideoUploadFinished.bind(d,f,g));f.upload(h)}else c?d._photosSelected(a):new(b("Dialog"))().setBody(i._("R\u1ea5t ti\u1ebfc, b\u1ea1n ch\u1ec9 c\u00f3 th\u1ec3 ch\u1ecdn t\u1ec7p video.")).setTitle(i._("File kh\u00f4ng \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3")).setModal(!0).setButtons(b("Dialog").OK).show()}};d.doFileUpload=function(a){__p&&__p();var c=!1,d=!1;switch(this._config.supportedFileTypes){case"photos":d=!0;break;case"videos":c=!0;break;case"both":c=d=!0;break}this._submitListener&&this._submitListener.remove();d=this.getVideoOrPhotoUploadCallback(a,d);c?b("ComposerXMediaUploadHandler").isVideoOrAnimatedGifAsync(a,d):d(!1)};d.getConfig=function(){return this._config};d._resizeUpload=function(a,c){__p&&__p();var d=this,e=a.getFile();if(!e||!b("PhotosMimeType").isJpeg(e.type))return c(a);var f=(j||(j=b("performanceNow")))();this.logStep("client_process_begin",{bytes:e.size,custom_tags:{high_quality:this._isHighQuality}});this._resizer.resizeBlob(e,function(g,h,i,k,l,m,n){__p&&__p();h=h||e;if(g){d.logStep("client_process_fail",{dt:(j||(j=b("performanceNow")))()-f,bytes:h.size,error_code:g.code,error_info:g.message,custom_tags:{high_quality:d._isHighQuality}});return c(a)}h.uploadID=e.uploadID;h.filename=e.name;a.setFile(h);d.logStep("client_process_success",{dt:(j||(j=b("performanceNow")))()-f,media_data_size:e.size,bytes:h.size,custom_tags:{high_quality:d._isHighQuality,skipped_resizing:i}});c(a)},this._onResizeProgress.bind(this,e.uploadID))};d._onResizeStart=function(a){this.logStep("client_process_begin",{bytes:a.size,custom_tags:{high_quality:this._isHighQuality}})};d._onResizeFail=function(a,b,c,d){this.logStep("client_process_fail",{dt:d,bytes:b.size,error_code:c.code,error_info:c.message,custom_tags:{high_quality:this._isHighQuality}})};d._onResizeSuccess=function(a,b,c,d){this.logStep("client_process_success",{dt:d,media_data_size:a.size,bytes:b.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:c}})};d._isExceedMaxSelect=function(a){return this._config.maxselect>1&&a>this._config.maxselect};d._showTooManyPhotosDialog=function(a){var c=a-this._config.maxselect;new(b("Dialog"))().setTitle(i._("Qu\u00e1 nhi\u1ec1u \u1ea3nh")).setBody(c>1?i._({"*":{"*":{"*":"B\u1ea1n ch\u1ec9 c\u00f3 th\u1ec3 th\u00eam t\u1ed1i \u0111a {maxselect} \u1ea3nh v\u00e0o m\u1ed9t b\u00e0i vi\u1ebft nh\u01b0ng b\u1ea1n \u0111\u00e3 ch\u1ecdn {photosattached} \u1ea3nh. Vui l\u00f2ng b\u1ecf ch\u1ecdn \u00edt nh\u1ea5t {unselect} \u1ea3nh."}}},[i._param("maxselect",this._config.maxselect,[0]),i._param("photosattached",a,[0]),i._param("unselect",c,[0])]):i._({"*":{"*":"B\u1ea1n ch\u1ec9 c\u00f3 th\u1ec3 th\u00eam t\u1ed1i \u0111a {maxselect} \u1ea3nh v\u00e0o m\u1ed9t b\u00e0i vi\u1ebft nh\u01b0ng b\u1ea1n \u0111\u00e3 ch\u1ecdn {photosattached} \u1ea3nh. Vui l\u00f2ng b\u1ecf ch\u1ecdn \u00edt nh\u1ea5t 1 \u1ea3nh."}},[i._param("maxselect",this._config.maxselect,[0]),i._param("photosattached",a,[0])])).setButtons(b("Dialog").OK).setModal(!0).show()};d._photosSelected=function(a){var b=a.getInput();b=o(b);if(this._isExceedMaxSelect(b)){this._showTooManyPhotosDialog(b);return}this._onBeforeAddUploadedImages();this._upload(a,b)};d._upload=function(a,c){var d=this,e=a.getInput(),f=this._config.uploadData;this._config.waterfallID&&(f.qn=this._config.waterfallID);var g=function(){b("Arbiter").inform("multi-upload/images-upload-start/"+d._gridID,{imageCount:c})};f=new(b("XComposerPhotoUploader"))({uploadEndpoint:this._config.photoEndpoint,uploadData:f,retryLimit:this._config.retryLimit,concurrentLimit:this._config.concurrentLimit,resizer:this._resizer,onUploadEnqueued:this._generateLoadingIndicatorForPhoto.bind(this),onUploadsEnqueued:g,onUploadSent:function(){return a.clear()},onResizeStart:this._onResizeStart.bind(this),onResizeProgress:this._onResizeProgress.bind(this),onResizeSuccess:this._onResizeSuccess.bind(this),onResizeFailure:this._onResizeFail.bind(this),onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFailure:this.fileUploadFailure.bind(this)});f.upload(e);this.logStep("client_select_success",{times_selected:m++,volume:c,method:"file_selector"})};d._onVideoRemoved=function(){this._dragDropTarget&&this._dragDropTarget.enable(),b("Arbiter").inform("multi-upload/video-removed/"+this._gridID)};d.removeLoadingIndicator=function(a){var c=this.getLoadingIndicator(a);c&&b("DOM").remove(c.getRoot());delete this._loadingIndicators[a];b("Arbiter").inform("multi-upload/loading-indicator-removed/"+this._gridID)};d._isUploadFinished=function(){return this._numRemainingFiles===0};d._informUploadStatus=function(a){var c=this;b("Bootloader").loadModules(["ReactComposerAttachmentActions"],function(b){b.changeUploadStatus(c._config.composerID,a)},"PhotosMultiUploadInput")};d._onEncodeFinished=function(a){this.stopInactivityTimer(a),this._markUploadAsFinished(),this._isUploadFinished()&&this._informUploadFinished()};d._onEncodeProgress=function(a){this._videoEncodeTimers[a]=this.startInactivityTimer(a)};d.startInactivityTimer=function(a){this._videoEncodeTimers[a]=setTimeout(b("OptimisticVideoPostUtils").checkVideoStatus.bind(this,a,this._onEncodeFinished.bind(this),this._onEncodeProgress.bind(this),this._onEncodeProgress.bind(this)),100)};d.stopInactivityTimer=function(a){clearTimeout(this._videoEncodeTimers[a])};d._onFileUploadStart=function(a,c){this._uploadIDToFileUpload[a]=c.upload;var d=b("DOM").find(this.getLoadingIndicator(a).getRoot(),"._639");b("CSS").show(d);this._uploadTimers[a]=Date.now();d={custom_tags:{high_quality:this._isHighQuality}};c.upload&&c.upload.getFile()&&(d.size=c.upload.getFile().size);this.logStep("client_transfer_begin",d);this._logComposerWaterfallEvent("add_photo")};d._onVideoUploadStart=function(a){this._generateLoadingIndicatorForPhoto(a),this._informUploadStatus(!0)};d._onVideoUploadProgress=function(a,c,d){c=this.getLoadingIndicator(a.uploadID);if(!c)return;a=Math.min(d.start_offset+d.sent_bytes,d.file_size);var e=Math.floor(a/d.file_size*100)+"%";this._showProgressBar(c);this._showProgressPosition(c,e);e={carousel_uploading:!0,loaded:a,total:d.file_size,skip_upload:d.skip_upload};b("updatePhotoProgressBar")(c,e)};d._onVideoUploadFinished=function(a,b,c,d){__p&&__p();this._config.isVideoCarouselPost&&a.post({draft:!0});c={};c.video_id=d.video_id;this._uploadParams[this._uploadIDToChildIndex[b.uploadID]]=c;this.startInactivityTimer(d.video_id,b.uploadID);this._numUploadsSucceeded++;a=this.getLoadingIndicator(b.uploadID);if(!a)return;c=this.getLoadingIndicator(b.uploadID);d=i._("encoding...");this._showProgressPosition(c,d);this._loadingIndicators[b.uploadID]=null};d._onUploadProgress=function(a,c){var d=this.getLoadingIndicator(a);if(!d||this._failedUploadIDs[a])return;this._showProgressBar(d);b("CSS").removeClass(d.getRoot(),"_5v_0");b("updatePhotoProgressBar")(d,c.event)};d._onResizeProgress=function(a,c){a=this.getLoadingIndicator(a);if(!a)return;this._showProgressBar(a);b("CSS").addClass(a.getRoot(),"_5v_0");a.setPosition(100*c.written/c.total)};d._showProgressBar=function(a){b("CSS").hide(b("DOM").find(a.getRoot(),"._2om")),b("CSS").show(b("DOM").find(a.getRoot(),"._5e4h"))};d._showProgressPosition=function(a,c){var d=b("DOM").find(a.getRoot(),"._318m");b("DOM").setContent(d,c);b("CSS").show(b("DOM").find(a.getRoot(),"._318n"))};d._onFileUploadSuccess=function(a,b){a=Date.now()-this._uploadTimers[a];a={dt:a};b.upload&&(a.bytes=b.upload.getFile().size,a.auto_retry_count=b.upload.getRetryCount?b.upload.getRetryCount():0,a.custom_tags={high_quality:this._isHighQuality,manual_retry:!!b.upload.getFile().manuallyRetried});this.logStep("client_transfer_success",a);this._logComposerWaterfallEvent("add_photo_success")};d._logComposerWaterfallEvent=function(a){if(!b("Parent").bySelector(b("$")(this._gridID),"._119"))return;b("ComposerXMarauderLogger").logEvent(a,this._getComposerID())};d._getComposerID=function(){return b("ComposerXController").getComposerID(this._gridID)};d._getAsyncUploadRequest=function(a){var c=new(b("XComposerPhotoUploader"))({uploadEndpoint:this._config.photoEndpoint,uploadData:this._config.uploadData,concurrentLimit:this._config.concurrentLimit,onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFail:this.fileUploadFailure.bind(this)});return c.getAsyncUploadRequest(a)};d._onEditedImage=function(a,c){__p&&__p();this._onBeforeAddUploadedImages();this.logStep("client_select_begin");this._generateUploadIDsAndLoadingIndicators([c.blob]);a=this._getGridItemElementByFBID(c.fbid);if(a){var d=this._loadingIndicators[c.blob.uploadID].getRoot();b("DOM").insertBefore(a,d)}b("Arbiter").inform("multi-upload/images-upload-start/"+this._gridID,{imageCount:1,method:b("PUWMethods").EDITOR});a=this._getAsyncUploadRequest([c.blob]);a.setData(Object.assign({},this._config.uploadData,{original_fbid:c.fbid,xy_tags:c.xyTags,stickers:c.stickers,text_overlays:c.textOverlays,has_crop:c.hasCrop,has_filter:c.hasFilter}));a.send();this.logStep("client_select_success",{volume:1,method:b("PUWMethods").EDITOR});this.logStep("client_photo_edit_success")};d._getGridItemElementByFBID=function(a){var c=b("DOM").scry(b("$")(this._gridID),".fbVaultGridItem");for(var d=0;d<c.length;d++)if(c[d].dataset.originalfbid==a)return c[d];return null};d.onVaultImagesAdded=function(a){var c=[];for(var d=0;d<a.length;d++)c.push({imageID:a[d]});this._generateUploadIDsAndLoadingIndicators(c);new(b("AsyncUploadRequest"))("/ajax/composerx/attachment/media/multi_upload_vault_images/").setData(Object.assign({},{vault_images:c,grid_id:this._gridID})).setAllowCrossOrigin(!0).send()};d.onFilesDrop=function(a,c){__p&&__p();if(this._isExceedMaxSelect(a.length)){this._showTooManyPhotosDialog(a.length);return}this._onBeforeAddUploadedImages();this.logStep("client_select_begin");this._generateUploadIDsAndLoadingIndicators(a);b("Arbiter").inform("multi-upload/images-upload-start/"+this._gridID,{imageCount:a.length,method:c||"dragdrop"});var d=this._getAsyncUploadRequest(a);this._resizer&&d.setPreprocessHandler(this._resizeUpload.bind(this));d.send();this.logStep("client_select_success",{volume:a.length,method:c||"dragdrop"})};d._retryFileUpload=function(a){this._numRemainingFiles++;b("Arbiter").inform("multi-upload/images-upload-start/"+this._gridID,{imageCount:1});this.logStep("client_transfer_manual_retry");a.manuallyRetried=!0;a=this._getAsyncUploadRequest([a]);a.send()};d._onBeforeAddUploadedImages=function(){this.sessionStarted||this.logStep("client_flow_begin"),this._config.maxselect==1&&b("Arbiter").inform("multi-upload/composer-reset/"+this._gridID),this.sessionStarted=!0};d.clearSession=function(){this.sessionStarted=!1};d.insertIntoGrid=function(a){var c=b("DOM").scry(b("$")(this._gridID),"._577")[0];c?b("DOM").insertBefore(c,a):b("DOM").prependContent(b("$")(this._gridID),a)};d._getUploadID=function(a,b){if(a.upload)return a.upload.getFile().uploadID;else return b.uploadID};a.getInstance=function(b){l[b]=l[b]||new a(b);return l[b]};return a}(b("mixin")(b("PhotosUploadWaterfallXMixin")));function o(a){return!p(a)?1:a.files.length}function p(a){return!!a.files&&b("AsyncUploadRequest").isSupported()}e.exports=a}),null);
__d("MercuryExperimentUtils",["fbt","qex"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(){__p&&__p();var a=b("qex")._("1269176");a===null&&(a=26214400);var c;switch(a){case 52428800:c=50;break;case 78643200:c=75;break;default:c=25}a=g._("File b\u1ea1n ch\u1ecdn qu\u00e1 l\u1edbn. K\u00edch th\u01b0\u1edbc t\u1ed1i \u0111a l\u00e0 {=size} MB",[g._param("=size",c)]);return a.toString()}c={getMaxAttachmentSizeExceededDialog:a};e.exports=c}),null);
__d("ChatFileUploadLoggingUtils",["CurrentUser","WorkContentActivityTypedLogger"],(function(a,b,c,d,e,f){"use strict";a={log:function(a,c){c===void 0&&(c="CHAT_MAIN"),b("CurrentUser").isWorkUser()&&new(b("WorkContentActivityTypedLogger"))().setSurfaceType(c).setEvent("CHAT_FILE_UPLOAD").setAdditionalData({file_size:a.size.toString(),file_type:a.type}).log()}};e.exports=a}),null);
__d("MercuryFileUploader",["csx","fbt","ArbiterMixin","ChatFileUploadLoggingUtils","CSS","Dialog","DOM","Event","FBLogger","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","MercuryExperimentUtils","PhotosUploadID","SubscriptionsHandler","getObjectValues","gkx","mixin","shield"],(function(a,b,c,d,e,f,g,h){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b,c,d,e){__p&&__p();var f;f=a.call(this)||this;f.$MercuryFileUploader1=b;f.$MercuryFileUploader2={};f.$MercuryFileUploader3={};f.$MercuryFileUploader4={};f.$MercuryFileUploader5={};f.$MercuryFileUploader6={};f.$MercuryFileUploader7={};f.$MercuryFileUploader8={};f.$MercuryFileUploader9={};f.$MercuryFileUploader10={};f.updateElements(c,d,e);return f}var d=c.prototype;d.updateElements=function(a,c,d){__p&&__p();this.$MercuryFileUploader11&&this.$MercuryFileUploader11.release();this.$MercuryFileUploader11=new(b("SubscriptionsHandler"))();this.$MercuryFileUploader12&&this.$MercuryFileUploader12.destroy();this.$MercuryFileUploader12=new(b("FileForm"))(a,[b("FormSubmitOnChange"),b("FileFormResetOnSubmit")]);this.$MercuryFileUploader12.setAllowCrossOrigin(!0);this.$MercuryFileUploader12.setUploadInParallel(!0);a=b("DOM").find(a,"._4q60");var e=b("DOM").find(a,"._4q61");new(b("FileInput"))(a,e,c);this.$MercuryFileUploader11.addSubscriptions(this.$MercuryFileUploader12.subscribe("submit",function(){__p&&__p();var a={count:0,file_sizes:[],files:[]};if(c.files){for(var e=0;e<c.files.length;e++){b("ChatFileUploadLoggingUtils").log(c.files[e]);if(c.files[e].size>b("MercuryConstants").AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return!1}}e={};for(var f=0;f<c.files.length;f++){var g=this.$MercuryFileUploader13();this.$MercuryFileUploader14(g,c.files[f].name);a.count++;a.file_sizes.push(c.files[f].size);e[g]=c.files[f];a.files.push({upload_id:g,metadata:c.files[f]})}this.$MercuryFileUploader12.setFiles(e)}else d.value=this.$MercuryFileUploader13(),this.$MercuryFileUploader14(d.value,c.value),a.count=1;this.inform("submit",a)}.bind(this)),this.$MercuryFileUploader12.subscribe("success",this.$MercuryFileUploader15.bind(this)),this.$MercuryFileUploader12.subscribe("failure",this.$MercuryFileUploader16.bind(this)),b("Event").listen(e,"click",b("shield")(this.inform,this,"open")))};d.showAttachmentSizeErrorDialog=function(){this.$MercuryFileUploader12.abort();this.$MercuryFileUploader12.clear();var a=b("MercuryExperimentUtils").getMaxAttachmentSizeExceededDialog();new(b("Dialog"))().setTitle(h._("File m\u00e0 b\u1ea1n \u0111\u00e3 ch\u1ecdn qu\u00e1 l\u1edbn")).setBody(b("gkx")("1147754")?h._("File b\u1ea1n ch\u1ecdn qu\u00e1 l\u1edbn. K\u00edch th\u01b0\u1edbc t\u1ed1i \u0111a l\u00e0 100 MB"):a).setButtons(b("Dialog").OK).setSemiModal(!0).show();b("FBLogger")("messenger_upload_file").warn("Uploading file is too large")};d.addDroppedFiles=function(a){__p&&__p();if(!this.$MercuryFileUploader12||!this.$MercuryFileUploader12.canUseXHR())return;var c={},d={count:0,file_sizes:[],files:[]};for(var e=0;e<a.length;e++){var f=a[e];if(f.size>b("MercuryConstants").AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return!1}var g=this.$MercuryFileUploader13();this.$MercuryFileUploader14(g,f.name);c[g]=f;d.file_sizes.push(f.size);d.count++;d.files.push({upload_id:g,metadata:f})}this.$MercuryFileUploader12.setFiles(c);this.$MercuryFileUploader12.forceSendViaXHR();this.inform("submit",d)};d.isUploading=function(){return!!Object.keys(this.$MercuryFileUploader8).length};d.addCachedAttachments=function(a){a.forEach(function(a){var b=this.$MercuryFileUploader13();this.$MercuryFileUploader14(b,a.filename);this.inform("cached-file-added",{upload_id:b,metadata:a});this.$MercuryFileUploader17(b,a)}.bind(this))};d.addCachedImageFiles=function(a){var b=h._("\u1ea2nh");a.forEach(function(a){var c=this.$MercuryFileUploader13();this.$MercuryFileUploader14(c,b);this.$MercuryFileUploader17(c,{filename:a,image_id:a,filetype:"image/jpeg"})}.bind(this))};d.getAttachments=function(){return b("getObjectValues")(this.$MercuryFileUploader2)};d.getImageFiles=function(){var a=this,b=Object.keys(this.$MercuryFileUploader3).sort(),c=[];b.forEach(function(b){return c.push(a.$MercuryFileUploader3[b])});return c};d.getAnimatedImageFiles=function(){return b("getObjectValues")(this.$MercuryFileUploader4)};d.getVideoFiles=function(){return b("getObjectValues")(this.$MercuryFileUploader5)};d.getAudioFiles=function(){return b("getObjectValues")(this.$MercuryFileUploader6)};d.getFiles=function(){return b("getObjectValues")(this.$MercuryFileUploader7)};d.removeOneAttachment=function(a){this.$MercuryFileUploader18(a)};d.removeAttachments=function(){this.$MercuryFileUploader1&&b("DOM").empty(this.$MercuryFileUploader1),this.$MercuryFileUploader2={},this.$MercuryFileUploader3={},this.$MercuryFileUploader4={},this.$MercuryFileUploader5={},this.$MercuryFileUploader6={},this.$MercuryFileUploader7={},this.$MercuryFileUploader9={},this.$MercuryFileUploader8={},this.$MercuryFileUploader10={},this.$MercuryFileUploader1&&b("CSS").hide(this.$MercuryFileUploader1),this.inform("dom-updated")};d.destroy=function(){this.$MercuryFileUploader11&&this.$MercuryFileUploader11.release(),this.$MercuryFileUploader12&&this.$MercuryFileUploader12.destroy(),this.removeAttachments()};d.$MercuryFileUploader14=function(a,c){__p&&__p();var d=b("MercuryAttachmentTemplates")[":fb:mercury:upload-file-row"].build(),e={};this.$MercuryFileUploader9[a]=d;this.$MercuryFileUploader8[a]=!0;this.$MercuryFileUploader10[a]=Date.now();c=i(c);b("DOM").appendContent(d.getNode("iconText"),c);e.fileName=c;b("Event").listen(d.getNode("closeFileUpload"),"click",this.$MercuryFileUploader18.bind(this,a));this.$MercuryFileUploader1&&(b("DOM").appendContent(this.$MercuryFileUploader1,d.getRoot()),b("CSS").show(this.$MercuryFileUploader1));this.inform("dom-updated",e)};d.$MercuryFileUploader18=function(a,c){__p&&__p();this.$MercuryFileUploader8[a]?this.inform("upload-canceled-during-upload"):(this.$MercuryFileUploader2[a]||this.$MercuryFileUploader3[a]||this.$MercuryFileUploader4[a]||this.$MercuryFileUploader5[a]||this.$MercuryFileUploader6[a]||this.$MercuryFileUploader7[a])&&this.inform("upload-canceled-after-uploaded");delete this.$MercuryFileUploader2[a];delete this.$MercuryFileUploader3[a];delete this.$MercuryFileUploader4[a];delete this.$MercuryFileUploader5[a];delete this.$MercuryFileUploader6[a];delete this.$MercuryFileUploader7[a];delete this.$MercuryFileUploader8[a];delete this.$MercuryFileUploader10[a];c=this.$MercuryFileUploader9[a];delete this.$MercuryFileUploader9[a];c&&(b("DOM").remove(c.getRoot()),this.inform("dom-updated"));this.inform("upload-canceled");return!1};d.$MercuryFileUploader19=function(a,c){a=this.$MercuryFileUploader9[a];c=b("MercuryAttachment").getAttachIconClassByMime(c);b("CSS").addClass(a.getNode("iconText"),c);b("CSS").addClass(a.getRoot(),"done")};d.$MercuryFileUploader17=function(a,b){this.$MercuryFileUploader8[a]&&(delete this.$MercuryFileUploader8[a],b.image_id?this.$MercuryFileUploader3[a]=b.image_id:b.gif_id?this.$MercuryFileUploader4[a]=b.gif_id:b.video_id?this.$MercuryFileUploader5[a]=b.video_id:b.audio_id?this.$MercuryFileUploader6[a]=b.audio_id:b.file_id?this.$MercuryFileUploader7[a]=b.file_id:this.$MercuryFileUploader2[a]=b,this.$MercuryFileUploader19(a,b.filetype),this.inform("one-upload-completed",{upload_time_ms:Date.now()-this.$MercuryFileUploader10[a],upload_id:a,metadata:b})),this.isUploading()||this.inform("all-uploads-completed",{count:this.getAttachments().length})};d.$MercuryFileUploader15=function(a,b){a=b.response.getPayload();this.$MercuryFileUploader17(this.$MercuryFileUploader20(b),a.metadata[0])};d.$MercuryFileUploader16=function(a,b){this.inform("one-upload-failed"),this.$MercuryFileUploader18(this.$MercuryFileUploader20(b),a)};d.$MercuryFileUploader13=function(){return"upload_"+b("PhotosUploadID").getNewID()};d.$MercuryFileUploader20=function(a){var b=a.response.getPayload();if(a.upload)return a.upload.getName();else return b.uploadID};return c}(b("mixin")(b("ArbiterMixin")));function i(a){return a&&a.startsWith("C:\\fakepath\\")?a.substring(12):a}e.exports=a}),null);
__d("VaultEditableGrid",["csx","Arbiter","AsyncRequest","CSS","DOM","Event","Scroll","$","ge","removeFromArray"],(function(a,b,c,d,e,f,g){__p&&__p();var h={};function a(a,c,d,e){__p&&__p();h[a.id]=this;this._grid=a;this._gridID=a.id;this._dialogEndpoint=c;this._collapseWhenEmpty=d;this._attachmentCount=e;this._selectedVaultImageIDs=[];(c=b("Arbiter")).subscribe("multi-upload/image-removed/"+this._gridID,function(a,c){b("removeFromArray")(this._selectedVaultImageIDs,c),this.updateAttachmentCount(this._attachmentCount-1)}.bind(this));c.subscribe("multi-upload/composer-reset/"+this._gridID,function(a,b){this.removeImages()}.bind(this));c.subscribe(["multi-upload/images-upload-start/"+this._gridID,"multi-upload/video-added/"+this._gridID],function(){this.updateAttachmentCount(this._attachmentCount+1)}.bind(this));c.inform("fbVaultEditableGrid/created/"+a.id,this,"persistent");c.subscribe("multi-upload/images-upload-start/"+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount)}Object.assign(a,{VAULT_IMAGE:"vault_image",getInstance:function(a){return h[a]},registerDialogWithGrid:function(a,c,d){b("Arbiter").subscribe(["multi-upload/images-upload-start/"+a,"multi-upload/video-added/"+a],d.hide.bind(d)),b("Arbiter").subscribe("fbVaultEditableGrid/created/"+a,function(a,b){b._registerDialogWithGrid(c,d)})},onImagesSelected:function(a,b,c){h[a]._onImagesSelected(b,c)}});Object.assign(a.prototype,{getRoot:function(){var a=b("ge")(this._gridID);if(a)return a;else return this._grid},_registerDialogWithGrid:function(a,c){__p&&__p();this._dialog=c;var d=this.getMoreLink();d&&b("Event").listen(d,"click",function(){c.show();return!1});c.subscribe("aftershow",function(){var c=[];b("DOM").scry(b("$")(this._gridID),'input[type="hidden"]').forEach(function(a){(a.name.match("composer_vault_images")||a.name.match("composer_unpublished_photo"))&&c.push(a.value)});var d=a.getGrid();d.bulkChange(function(){var a=d.getSelectionSet();a.clear();a.addAll(c)})}.bind(this))},updateAttachmentCount:function(a){this._attachmentCount=a,this._collapseWhenEmpty&&b("CSS").conditionShow(this._grid,this._attachmentCount>0)},getID:function(){return this._gridID},_onImagesSelected:function(a,c){var d=b("DOM").find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=c;a.forEach(function(a){b("DOM").insertBefore(d,a)});b("Arbiter").inform("multi-upload/images-added/"+this._gridID,{fbids:c});this._scrollToRight()},removeImages:function(){b("DOM").scry(this.getRoot(),".fbVaultGridItem").forEach(function(a){b("CSS").hasClass(a,"fbVaultEditableGridMoreLink")||b("DOM").remove(a)}),this._selectedVaultImageIDs=[],b("Arbiter").inform("multi-upload/all-images-removed/"+this._gridID),this.updateAttachmentCount(0)},_scrollToRight:function(){var a=this.getRoot(),c=b("DOM").find(a,".fbScrollableAreaWrap");b("Scroll").setLeft(c,Math.max(0,b("DOM").find(a,".fbScrollableAreaBody").offsetWidth-c.offsetWidth))},showDialog:function(a,c){this._dialog?this._dialog.show():b("AsyncRequest").bootstrap(this._dialogEndpoint,a)},getMoreLink:function(){return b("DOM").scry(this.getRoot(),".fbVaultEditableGridMoreLink")[0]}});e.exports=a}),null);
__d("BasePhotoUploader",["Arbiter","ArbiterMixin","CSS","DOM","PhotosMultiUploadInput","TimelineMapScrollableArea","VaultEditableGrid","getObjectValues","mixin"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d){__p&&__p();var e;e=a.call(this)||this;new(b("TimelineMapScrollableArea"))(c,{verticalscroll:!0});e.$BasePhotoUploader1=c;e.$BasePhotoUploader2=e.$BasePhotoUploader3();e.$BasePhotoUploader4=!1;e.$BasePhotoUploader5=null;d.addSubscriptions(b("Arbiter").subscribe("multi-upload/images-added/"+e.$BasePhotoUploader1.id,function(a,c){a=Object.assign({},c.fbids);Object.assign(this.$BasePhotoUploader2,a);this.$BasePhotoUploader6();this.inform("upload-completed",{fbids:b("getObjectValues")(a)})}.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/image-removed/"+e.$BasePhotoUploader1.id,function(a,b){for(var c in this.$BasePhotoUploader2)if(this.$BasePhotoUploader2[c]===b){delete this.$BasePhotoUploader2[c];break}this.$BasePhotoUploader6()}.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/images-upload-start/"+e.$BasePhotoUploader1.id,function(a,c){b("CSS").show(this.$BasePhotoUploader1),this.$BasePhotoUploader4=!0,this.inform("dom-updated"),this.inform("upload-started",c)}.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/composer-reset/"+e.$BasePhotoUploader1.id,e.clear.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/all-images-removed/"+e.$BasePhotoUploader1.id,e.$BasePhotoUploader7.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/images-upload-completed/"+e.$BasePhotoUploader1.id,function(a){this.$BasePhotoUploader4=!1,this.inform("all-uploads-completed"),this.$BasePhotoUploader6()}.bind(babelHelpers.assertThisInitialized(e))));b("CSS").conditionShow(e.$BasePhotoUploader1,Object.keys(e.$BasePhotoUploader2).length);return e}var d=c.prototype;d.getSelectedFBIDs=function(){var a=this,b=Object.keys(this.$BasePhotoUploader2).sort();return b.map(function(b){return a.$BasePhotoUploader2[b]})};d.isUploading=function(){return this.$BasePhotoUploader4};d.clear=function(){var a=b("VaultEditableGrid").getInstance(this.$BasePhotoUploader1.id);a&&a.removeImages()};d.getWaterfallID=function(){return b("PhotosMultiUploadInput").getWaterfallID(this.$BasePhotoUploader1.id)};d.$BasePhotoUploader7=function(){this.$BasePhotoUploader2={},this.$BasePhotoUploader4=!1,b("CSS").hide(this.$BasePhotoUploader1),this.inform("all-uploads-completed"),this.inform("dom-updated")};d.$BasePhotoUploader3=function(){var a={},c=-1e4;b("DOM").scry(this.$BasePhotoUploader1,'input[type="hidden"]').forEach(function(b){b.name.match("composer_vault_images")&&(a[c]=b.value,c--)});return a};d.$BasePhotoUploader6=function(){b("CSS").conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length>0),this.inform("dom-updated")};d.setCurrentMethod=function(a){this.$BasePhotoUploader5=a};d.getCurrentMethod=function(){return this.$BasePhotoUploader5};return c}(b("mixin")(b("ArbiterMixin")));e.exports=a}),null);
__d("MercuryPhotoUploader",["csx","cx","Arbiter","AsyncRequest","BasePhotoUploader","DOM","Event","FileInput","Focus","Parent","PhotosMultiUploadInput","VaultEditableGrid"],(function(a,b,c,d,e,f,g,h){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f){__p&&__p();e=a.call(this,c,e)||this;e.$MercuryPhotoUploader1=c.id;e.$MercuryPhotoUploader2=!1;b("Arbiter").subscribe("PhotosMultiUploadInput/loaded/"+c.id,function(){this.$MercuryPhotoUploader2=!0}.bind(babelHelpers.assertThisInitialized(e)));b("Arbiter").subscribe("MercuryPhotoUploader/initUploadButton/"+c.id,function(){var a=b("DOM").scry(d,'input[type="file"]')[0];a||(a=b("DOM").create("input",{accept:"image/*",type:"file",className:"_n",name:"composer_unpublished_photo[]",multiple:1}));var e=b("Parent").bySelector(d,"._9_h");e=new(b("FileInput"))(e,b("DOM").find(e,"._214"),a);e.subscribe("change",b("PhotosMultiUploadInput").doFileUpload.bind(null,c.id,e))});b("Arbiter").subscribe("MercuryPhotoUploader/registerPhotoMenu/"+c.id,function(a,e){__p&&__p();a=e.menu.getRoot();e.menu.setContext(d);var f=b("DOM").scry(a,"._d2p"),g=f&&f[0];g&&b("Event").listen(g,"click",function(){b("VaultEditableGrid").getInstance(c.id).showDialog(g,b("VaultEditableGrid").VAULT_IMAGE),this.setCurrentMethod("vault"),this.inform("selection-start",{method:"vault"})}.bind(this));b("Event").listen(d,"click",function(){if(!this.$MercuryPhotoUploader2)return;if(!e.menu.isShown()){var a=b("DOM").scry(e.menu.getContentRoot(),"li");this.inform("menu-show");e.menu.show();a&&b("Focus").setWithoutOutline(a[0])}else this.inform("menu-hide"),e.menu.hide()}.bind(this));b("Event").listen(document.documentElement,"click",function(a){!b("DOM").contains(d,a.getTarget())&&!b("DOM").contains(g,a.getTarget())&&(e.menu.isShown()&&this.inform("menu-hide"),e.menu.hide())}.bind(this));f=b("DOM").find(a,"._9_h");b("Event").listen(f,"click",function(){this.setCurrentMethod("file_selector"),this.inform("selection-start",{method:"file_selector"})}.bind(this))}.bind(babelHelpers.assertThisInitialized(e)));f&&b("PhotosMultiUploadInput").initDragDrop(c.id,f);return e}var d=c.prototype;d.uploadPastedFile=function(a){b("PhotosMultiUploadInput").onFilesDrop(this.$MercuryPhotoUploader1,[a])};d.addCachedPhotos=function(a){b("AsyncRequest").post("/ajax/vault/selected.php",{max_select:10,grid_id:this.$MercuryPhotoUploader1,source:"messenger",image_ids:a})};return c}(b("BasePhotoUploader"));Object.assign(a,{initUploadButton:function(a){b("Arbiter").inform("MercuryPhotoUploader/initUploadButton/"+a,{},"persistent")},registerPhotoMenu:function(a,c){b("Arbiter").inform("MercuryPhotoUploader/registerPhotoMenu/"+a,{menu:c},"persistent")}});e.exports=a}),null);
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Event","Form","URLScraper","isEmpty","mixin"],(function(a,b,c,d,e,f){__p&&__p();var g;a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var b;b=a.call(this)||this;b.__initialize.apply(babelHelpers.assertThisInitialized(b),arguments);return b}var d=c.prototype;d.__initialize=function(a,c,d,e,f){this.$MercuryShareLinkUploader1=a,this.$MercuryShareLinkUploader2=c,this.$MercuryShareLinkUploader3=d,this.$MercuryShareLinkUploader4=f,this.$MercuryShareLinkUploader5=!1,this.$MercuryShareLinkUploader6=null,this.$MercuryShareLinkUploader7=null,b("Event").listen(e,"click",this.close.bind(this)),b("Event").listen(f,"keyup",function(){f.value.length||this.$MercuryShareLinkUploader8.enable()}.bind(this)),this.$MercuryShareLinkUploader8=new(b("URLScraper"))(f),this.$MercuryShareLinkUploader8.subscribe("match",function(a,b){this.loadShare(b&&b.url)}.bind(this))};d.getAttachData=function(){return this.loadAttachData(this.$MercuryShareLinkUploader5,this.$MercuryShareLinkUploader1,this.$MercuryShareLinkUploader4)};d.getShareDataFromStage=function(a,c){__p&&__p();a=b("Form").serialize(c);c=a.attachment&&a.attachment.params;if(!c)return null;if(c instanceof Object){var d=[];d.push(c[0]);d.push(c[1]);c=d}return{params:c,type:a.attachment.type}};d.loadAttachData=function(a,c,d){__p&&__p();if(!a)return null;a=b("Form").serialize(c);c=a.attachment&&a.attachment.params;var e=a.attachment&&a.attachment.type;a=a.link_metrics?a.link_metrics.no_image:!0;if(!c||(g||(g=b("isEmpty")))(c)||!e)return null;d=d.value;if(d.indexOf(c.url)===-1)return{share_params:c,share_type:e};return!c.summary&&!c.favicon&&a&&c.title&&c.url&&c.url.substr(0,c.title.length)===c.title?null:{share_params:c,share_type:e}};d.check=function(){this.$MercuryShareLinkUploader8.check()};d.close=function(){this.$MercuryShareLinkUploader9(),this.$MercuryShareLinkUploader8.disable(),this.inform("closed")};d.clear=function(){this.$MercuryShareLinkUploader9(),this.$MercuryShareLinkUploader8.enable()};d.enable=function(){this.$MercuryShareLinkUploader8.enable()};d.disable=function(){this.$MercuryShareLinkUploader8.disable()};d.loadShare=function(a){this.$MercuryShareLinkUploader6=a,this.$MercuryShareLinkUploader7&&this.$MercuryShareLinkUploader7.abort(),this.$MercuryShareLinkUploader7=new(b("AsyncRequest"))().setMethod("POST").setURI("/ajax/share_scrape.php").setData({u:a}).setHandler(this.$MercuryShareLinkUploader10.bind(this).bind(null,a)).setStatusElement(this.$MercuryShareLinkUploader3),this.$MercuryShareLinkUploader7.send(),this.inform("link-detected")};d.$MercuryShareLinkUploader10=function(a,c){__p&&__p();if(this.$MercuryShareLinkUploader6!==a)return;this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7=null;b("CSS").show(this.$MercuryShareLinkUploader1);b("DOM").empty(this.$MercuryShareLinkUploader2);b("DOM").setContent(this.$MercuryShareLinkUploader2,c.payload);this.$MercuryShareLinkUploader5=!0;if(!this.getAttachData()){this.close();return}};d.$MercuryShareLinkUploader9=function(){b("CSS").hide(this.$MercuryShareLinkUploader1),this.$MercuryShareLinkUploader5=!1,this.$MercuryShareLinkUploader6=null,this.$MercuryShareLinkUploader7&&this.$MercuryShareLinkUploader7.abort(),this.$MercuryShareLinkUploader7=null,this.$MercuryShareLinkUploader8.reset()};return c}(b("mixin")(b("ArbiterMixin")));e.exports=a}),null);
__d("MercuryDataSources",[],(function(a,b,c,d,e,f){var g={};a={add:function(a,b){g[a]=b},get:function(a){!g[a];return g[a]}};e.exports=a}),null);
__d("MercuryTypeaheadCore",["Event","Keys","TypeaheadCore"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){var c;c=a.call(this,b)||this;c.showDefaultOnNoInput=!1;c.showDefaultOnNoInput=b.showDefaultOnNoInput||!1;return c}var d=c.prototype;d.initData=function(){var b=this;a.prototype.initData.call(this);this.showDefaultOnNoInput&&(this.data.subscribe("show-default",function(){b.getValue()==""&&!b.element.disabled&&b.data.defaultList&&b.view.render("",b.data.defaultList,!1)}),this.data.defaultList&&this.view.render("",this.data.defaultList,!1))};d.keyup=function(c){a.prototype.keyup.call(this);if(this.getValue().length===0&&this.showDefaultOnNoInput){switch(b("Event").getKeyCode(c)){case b("Keys").ESC:return}this.data.showDefaultList&&this.data.inform("show-default")}};d.focus=function(){var b=!1;this.view.isVisible()||(b=!0);a.prototype.focus.call(this);if(!b)return;this.view.isVisible()&&this.data.showDefaultList&&this.getValue().length===0&&this.data.inform("show-default")};d.click=function(){this.getValue().length===0&&this.view.isVisible()&&this.data.showDefaultList&&this.data.inform("show-default"),a.prototype.click.call(this)};return c}(b("TypeaheadCore"));e.exports=a}),null);
__d("MercuryTypeahead",["cx","ArbiterMixin","DOM","DOMDimensions","Event","Input","Keys","MercuryConfig","MercuryTypeaheadCore","MercuryTypeaheadTemplates","Tokenizer","Typeahead"],(function(a,b,c,d,e,f,g){__p&&__p();a=function(a,c){this._domElement=null,this._typeahead=null,this._tokenizer=null,this._placeholder="",this._exclusions=[],this._viewNodeOrID=null,this._viewOptions={renderer:"compact",autoSelect:!b("MercuryConfig").ChatComposer},this._tokenizerBehaviors=[],this._heightPrev=null,this._dataSource=a,this._view=c};Object.assign(a.prototype,b("ArbiterMixin"));Object.assign(a.prototype,{setPlaceholder:function(a){this._placeholder=a;return this},setExcludedParticipantsFromThreadMeta:function(a){if(!a)return;this.setExcludedParticipants(a.participants)},setExcludedParticipants:function(a){this._exclusions=[];a.forEach(function(a){var b=a.indexOf(":");a.substr(0,b)=="fbid"&&this._exclusions.push(a.substr(b+1))}.bind(this));return this},setViewNodeID:function(a){this._viewNodeOrID=a},setViewNode:function(a){this._viewNodeOrID=a},setFullWidthView:function(a){var c=b("DOM").create("div",{className:"_4ck uiTypeaheadView"});b("DOM").setContent(a,c);this.setViewNode(c)},setViewOption:function(a,b){this._viewOptions[a]=b},addTokenizerBehavior:function(a){this._tokenizerBehaviors.push(a)},build:function(a){__p&&__p();var c;if(this._domElement)return;a=b("MercuryTypeaheadTemplates")[":fb:mercury:tokenizer"].build();var d=b("MercuryTypeaheadTemplates")[":fb:mercury:typeahead"].build();this._domElement=a.getRoot();b("DOM").appendContent(this._domElement,d.getRoot());var e=d.getNode("textfield");b("Input").setPlaceholder(e,this._placeholder);e.setAttribute("data-placeholder",this._placeholder);this._input=e;var f={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions};c=(c=this._dataSource)!=null?c.showDefaultList:c;c={ctor:b("MercuryTypeaheadCore"),options:{setValueOnSelect:!0,showDefaultOnNoInput:c,resetOnKeyup:!c}};this._typeahead=new(b("Typeahead"))(this._dataSource,f,c,d.getRoot());this._typeahead.init();f={inline:!0,behaviors:this._tokenizerBehaviors};this._tokenizer=new(b("Tokenizer"))(this._domElement,this._typeahead);this._tokenizer.init(a.getNode("tokenarea"),"participants",[],f);this._tokenizer.subscribe(["addToken","removeToken","removeAllTokens"],this._tokensChanged.bind(this));this._tokenizer.subscribe(["addTokenWithQuery"],this._tokenAdded.bind(this));this._tokenizer.subscribe(["removeToken"],this._tokenRemoved.bind(this));this._tokenizer.subscribe("resize",function(){this.inform("resize")}.bind(this));b("Event").listen(e,"focus",function(){this._resetDataSource(),this._typeahead.init()}.bind(this));b("Event").listen(this._domElement,"click",this.focus.bind(this));b("Event").listen(e,"keydown",this.keydown.bind(this));b("Event").listen(e,"input",this.input.bind(this));this._heightPrev=b("DOMDimensions").getElementDimensions(this._domElement).height},getElement:function(){return this._domElement},getSelectedParticipantIDs:function(){var a=[];this._tokenizer&&(this._tokenizer.getTokenValues()||[]).forEach(function(b){a.push("fbid:"+b)});return a},getTokens:function(){var a=[];this._tokenizer&&(a=this._tokenizer.getTokens());return a},getTokenizer:function(){return this._tokenizer},input:function(a){this.inform("queryChange",{query:a.target.value})},keydown:function(a){__p&&__p();if(this._tokenizer.inline&&a.keyCode==b("Keys").ESC){if(b("Input").isEmpty(this._input)){var c=this._tokenizer.getLastToken();if(c&&c.isRemovable()){this._tokenizer.removeToken(c);a.stopPropagation();return}}else{this._typeahead.getCore().reset();a.stopPropagation();return}this.inform("esc-pressed");return}c=this._typeahead.getView();c=c&&c.index!==-1;if(b("Input").isEmpty(this._input)&&this._tokenizer.inline&&a.keyCode===b("Keys").RETURN){if(b("MercuryConfig").ChatComposer&&c)return;a.preventDefault();return this.inform("tokens-return")}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens(),this._typeahead&&this._typeahead.getCore().reset()},focus:function(){this._tokenizer&&this._tokenizer.focusInput()},getTypeahead:function(){return this._typeahead},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions)},_tokensChanged:function(){this.inform("tokens-changed")},_tokenAdded:function(a,b){this.inform("token-added",b);if(this._dataSource.updateDefaultList!=null){b=(a=b)!=null?(a=a.token)!=null?(a=a.info)!=null?a.uid:a:a:a;this._dataSource.updateDefaultList(b)}},_tokenRemoved:function(a,b){if(this._dataSource.updateDefaultList!=null){a=(a=b)!=null?(a=a.info)!=null?a.uid:a:a;this._dataSource.updateDefaultList(a)}this.inform("token-removed",b)}});e.exports=a}),null);
__d("MercuryTypeaheadRenderer",["cx","Badge.react","CSS","DOM","Event","Image.react","MercuryParticipantsConstants","MercuryTypeaheadTemplates","React","ReactDOM"],(function(a,b,c,d,e,f,g){__p&&__p();function h(a,c){__p&&__p();var d;switch(a.type){case"header":d=b("MercuryTypeaheadTemplates")[":fb:mercury:typeahead:header"].build();h.renderHeader(d,a);break;case"user":case"page":d=b("MercuryTypeaheadTemplates")[":fb:mercury:typeahead:result"].build();h.renderPerson(d,a);break;default:throw new Error("Unsupported result type: "+a.type)}return d.getRoot()}Object.assign(h,{renderHeader:function(a,c){__p&&__p();if(c.disabled){b("CSS").hide(a.getRoot());return}var d=c.getLinkHandler&&c.getLinkHandler();if(d){var e=a.getNode("link");b("DOM").setContent(e,c.linkText);b("Event").listen(e,"click",d)}else b("CSS").hide(a.getNode("link"));a.setNodeContent("text",c.text)},renderPersonWithBigPhoto:function(a,c){i(a,c,b("MercuryParticipantsConstants").BIG_IMAGE_SIZE)},renderPerson:function(a,c){i(a,c,b("MercuryParticipantsConstants").IMAGE_SIZE)},renderPage:function(a,c){i(a,c,b("MercuryParticipantsConstants").IMAGE_SIZE)}});function i(a,c,d){__p&&__p();if(c.photo){d=b("React").jsx(b("Image.react"),{width:d,height:d,src:c.photo});b("ReactDOM").render(d,a.getNode("image"))}c.text&&(b("DOM").setContent(a.getNode("name"),c.text),a.getRoot().setAttribute("aria-label",c.text));d=[];(c.subtext||c.category)&&(c.subtext&&d.push(c.subtext),c.category&&d.push(c.category),b("DOM").appendContent(a.getNode("snippet"),d.join(" \xb7 ")));var e=null;c.is_verified&&(e=b("React").jsx(b("Badge.react"),{type:"verified",size:"xsmall"}),b("ReactDOM").render(e,a.getNode("badge")));if(c.non_employee){d.length&&b("DOM").prependContent(a.getNode("snippet")," \xb7 ");e=b("DOM").create("span",{className:"_52l8 highlight"},"(Non-Employee)");b("DOM").prependContent(a.getNode("snippet"),e)}if(c.render_type==="meeting_room_page"){d={href:"/"+c.uid.toString(),target:"_blank",role:"link"};b("DOM").setAttributes(a.getNode("threadLink"),d)}}e.exports=h}),null);
__d("TabIndexDelegator",["CSS","DOM","Event","Focus","JSXDOM"],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,c){this._placeholder=c||b("JSXDOM").button(null),this._placeholder.setAttribute("aria-hidden",!0),b("CSS").addClass(this._placeholder,"accessible_elem"),this._listener=b("Event").listen(this._placeholder,"click",function(){a.click()}),this._focusRelocator=b("Focus").relocate(this._placeholder,a),this.enable()}var c=a.prototype;c.enable=function(){b("CSS").show(this._placeholder)};c.disable=function(){b("CSS").hide(this._placeholder)};c.getPlaceholder=function(){return this._placeholder};c.destroy=function(){this._listener.remove(),this._focusRelocator.remove(),b("DOM").remove(this._placeholder)};return a}();e.exports=a}),null);
__d("MercuryComposerDialogControl",["csx","fbt","Arbiter","Button","ContextualTypeaheadView","CSS","CurrentUser","Dialog","DialogX","DOM","Input","JSLogger","LayerHideOnTransition","MercuryDataSources","MercuryErrorInfo","MercuryFileUploader","MercuryIDs","MercuryPhotoUploader","MercuryShareLinkUploader","MercuryTypeahead","MercuryTypeaheadRenderer","MercuryMessageActions","MercuryMessageObject","MessengerState.bs","PagesEventObserver","Run","SiteData","SubscriptionsHandler","TabIndexDelegator","MercuryThreadInformer","Token","WorkFileUploadsGating"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i=b("MercuryMessageActions").get(),j=b("MercuryMessageObject").get(),k=b("MercuryThreadInformer").get(),l=b("JSLogger").create("mercury_composer_dialog");function a(a,c,d,e,f,g,i){__p&&__p();var j=this,q;this._dialog=a;this._errorBox=(q=b("DOM")).find(a.getRoot(),"._2oi");this._typeahead=m(this,q.find(a.getRoot(),"._22i"),d);this._textarea=q.find(a.getRoot(),"._2oj");this._sendButton=q.find(a.getRoot(),"._2ok");this._uploadWarning=q.find(a.getRoot(),"._2wj");this._attachButtonForm=q.scry(a.getRoot(),"._212")[0];this._photoButton=q.scry(a.getRoot(),"._214")[0];this._confirmationDialogContent=c;this._entryPoint=g;this._autohide=f;this._ref=i;this._delegator=new(b("TabIndexDelegator"))(this._sendButton);this._attachButtonForm?b("DOM").insertBefore(this._attachButtonForm,this._delegator.getPlaceholder()):this._photoButton&&b("DOM").insertBefore(this._photoButton,this._delegator.getPlaceholder());setTimeout(n.bind(this),0);o.call(this);this._subscriptionsHandler=new(b("SubscriptionsHandler"))();this._subscriptionsHandler.addSubscriptions(this._dialog.subscribe("confirm",function(){p(this)}.bind(this)),this._dialog.subscribe("hide",function(){this._subscriptionsHandler.release()}.bind(this)),k.subscribe("messages-updated",function(a,b){if(this._midWaitingConfirmation)for(var c in b)b[c][this._midWaitingConfirmation]&&u(this)}.bind(this)));d=function(){a.disableBehavior(b("LayerHideOnTransition"))};q=function(){setTimeout(a.enableBehavior.bind(a,b("LayerHideOnTransition")),0)};this._subscriptionsHandler.addSubscriptions(b("Arbiter").subscribe("PhotoSnowlift.OPEN",d),b("Arbiter").subscribe("PhotoSnowlift.CLOSE",q));c=b("DOM").scry(a.getRoot(),".fbVaultEditableGrid")[0];c||(c=b("DOM").find(a.getRoot(),".fbVaultGrid"));c||l.error('Could not find an image grid in the "Send Message" dialog.');this._photoUploader=new(b("MercuryPhotoUploader"))(c,this._photoButton,this._subscriptionsHandler,b("DOM").find(a.getRoot(),"._2qi"));e&&(b("Input").setValue(this._textarea,e),this._shareLinkUploader.check());b("Run").onBeforeUnload(function(){if(!j._dialog.isShown())return null;var a=r(j);return!s(j,a)?null:h._("B\u1ea1n ch\u01b0a ho\u00e0n t\u1ea5t b\u00e0i vi\u1ebft. B\u1ea1n c\u00f3 mu\u1ed1n b\u1ecf d\u1edf kh\u00f4ng?")})}function m(a,c,d){__p&&__p();var e={};e.friend={uid:"friend",type:"header",disabled:!0};e.non_friend={uid:"non_friend",text:h._("Ng\u01b0\u1eddi kh\u00e1c"),type:"header"};e.page={uid:"page",text:h._("Trang"),type:"header"};var f=new(b("MercuryTypeahead"))(b("MercuryDataSources").get("MercuryRecipientsDataSource"),b("ContextualTypeaheadView"));f.setViewOption("renderer",b("MercuryTypeaheadRenderer"));f.setViewOption("typeObjects",e);a._dialog.subscribe("aftershow",function(){f.setFullWidthView(c),f.build(),b("DOM").appendContent(c,f.getElement()),(d||[]).length?(d.forEach(function(c){f.getTokenizer().addToken(new(b("Token"))(c)),c.type=="page"&&x(a,!0)}),a._textarea.focus()):f.focus(),f.getTokenizer().setPlaceholder(h._("T\u00ean"))});return f}function n(){if(b("WorkFileUploadsGating").canUploadFiles){var a=b("DOM").scry(this._dialog.getRoot(),"._4q60 ._n");a.length>0&&(this._fileUploader=new(b("MercuryFileUploader"))(b("DOM").find(this._dialog.getRoot(),"._2qc"),this._attachButtonForm,a[0],b("DOM").find(this._dialog.getRoot(),"._2qd")),this._subscriptionsHandler.addSubscriptions(this._fileUploader.subscribe(["all-uploads-completed","upload-canceled"],w.bind(this))))}this._photoUploader&&this._subscriptionsHandler.addSubscriptions(this._photoUploader.subscribe("all-uploads-completed",w.bind(this)))}function o(){var a;this._shareLinkUploader=new(b("MercuryShareLinkUploader"))((a=b("DOM")).find(this._dialog.getRoot(),"._2v0"),a.find(this._dialog.getRoot(),"._2v1"),a.find(this._dialog.getRoot(),"._2v2"),a.find(this._dialog.getRoot(),"._2v3"),this._textarea)}function p(a){__p&&__p();var b=r(a);if(b.specific_to_list.length&&a._fileUploader&&a._fileUploader.isUploading()){v.call(a);return}if(this._midWaitingConfirmation||!s(a,b)||!b.specific_to_list.length)return null;i.send(b);t(a,b.message_id);q(a,b)}function q(a,c){a._typeahead.getTokens().forEach(function(d){d.getInfo().type==="page"&&b("PagesEventObserver").logData_DEPRECATED({page_id:d.getValue(),event_name:"messages_send_entry_point",entry_point:a._entryPoint,message_id:c.message_id,ref:a._ref,thread_id:c.thread_id},null)})}function r(a){__p&&__p();var c=a._typeahead.getTokens();c=c.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.getValue())});c=j.constructUserGeneratedMessageObject(b("Input").getValue(a._textarea),"source:titan:web",null,c);c.ui_push_phase=b("SiteData").push_phase;c.specific_to_list.length==1&&c.author==c.specific_to_list[0]&&c.specific_to_list.push(c.author);if(a._fileUploader){var d=a._fileUploader.getAttachments();d&&d.length&&(c.has_attachment=!0,c.raw_attachments=d)}a._shareLinkUploader.getAttachData()&&(c.has_attachment=!0,c.shareable_attachment=a._shareLinkUploader.getAttachData());if(a._photoUploader){d=a._photoUploader.getSelectedFBIDs();d.length>0&&(c.has_attachment=!0,c.photo_fbids=d)}if(a._fileUploader){d=a._fileUploader.getImageFiles();d.length>0&&(c.has_attachment=!0,c.image_ids=d);d=a._fileUploader.getVideoFiles();d.length>0&&(c.has_attachment=!0,c.video_ids=d);d=a._fileUploader.getAudioFiles();d.length>0&&(c.has_attachment=!0,c.audio_ids=d);d=a._fileUploader.getFiles();d.length>0&&(c.has_attachment=!0,c.file_ids=d)}return c}function s(a,c){return!b("Input").isEmpty(a._textarea)||c.has_attachment}function t(a,c){a._midWaitingConfirmation=c,b("CSS").hide(a._errorBox),z.bind(a)()}function u(a){__p&&__p();var c=a._midWaitingConfirmation;delete a._midWaitingConfirmation;c=b("MessengerState.bs").getMessagesFromIDs(b("CurrentUser").getID(),[c])[0];if(c&&c.status==1){a._dialog.hide();var d=new(b("DialogX"))({width:b("Dialog").SIZE.STANDARD,autohide:a._autohide,addedBehaviors:[b("LayerHideOnTransition")]},a._confirmationDialogContent);d.show();a._dialog.inform("Messenger/message-sent",{confirmation_dialog:d})}else b("DOM").setContent(a._errorBox,b("MercuryErrorInfo").getMessage(c.error_data)),b("CSS").show(a._errorBox),A.call(a)}function v(){this._blocked=!0,b("CSS").show(this._uploadWarning),z.bind(this)()}function w(){if(this._blocked){if(this._fileUploader&&this._fileUploader.isUploading())return;this._blocked=!1;b("CSS").hide(this._uploadWarning);p(this)}}function x(a,b){b&&(a._typeaheadDisabled=!0);b=a._typeahead.getTypeahead().getCore();b.getElement().setAttribute("disabled","disabled")}function y(a){if(!a._typeaheadDisabled){a=a._typeahead.getTypeahead().getCore();a.getElement().removeAttribute("disabled")}}function z(){x(this,!1),this._textarea.setAttribute("disabled","disabled"),b("Button").setEnabled(this._sendButton,!1),this._delegator.disable()}function A(){y(this),this._textarea.removeAttribute("disabled"),b("Button").setEnabled(this._sendButton,!0),this._delegator.enable()}e.exports=a}),null);
__d("MercuryRecipientsDataSource",["DataSource"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(b,a);function b(b){b=b||{};b.kanaNormalization=!0;return a.call(this,b)||this}var c=b.prototype;c.buildData=function(b){var c=this,d=[],e=[];b.forEach(function(b){var f=a.prototype.getEntry.call(c,b);if(f.render_type=="non_friend"){var g=2;e.length<g&&e.push(b)}else d.length<4&&(f.render_type="friend",d.push(b))});return a.prototype.buildData.call(this,d.concat(e))};return b}(b("DataSource"));e.exports=a}),null);
__d("XHPTemplate",["DataStore","DOM","HTML","XHPTemplateProcessor"],(function(a,b,c,d,e,f){__p&&__p();var g=b("XHPTemplateProcessor").processor;a=function(){"use strict";__p&&__p();function a(a){g instanceof Function&&(a=g(a)),this._model=a}var c=a.prototype;c.render=function(){b("HTML").isHTML(this._model)&&(this._model=b("DOM").setContent(document.createDocumentFragment(),this._model)[0]);return this._model.cloneNode(!0)};c.build=function(){return new h(this.render())};a.getNode=function(b,c){return a.getNodes(b)[c]};a.getNodes=function(a){__p&&__p();var c=b("DataStore").get(a,"XHPTemplate:nodes");if(!c){c={};var d=b("DOM").scry(a,"[data-jsid]");d.push(a);var e=d.length;while(e--){var f=d[e];c[f.getAttribute("data-jsid")]=f;f.removeAttribute("data-jsid")}b("DataStore").set(a,"XHPTemplate:nodes",c)}return c};return a}();var h=function(){"use strict";__p&&__p();function a(a){this._root=a,this._populateNodes()}var c=a.prototype;c._populateNodes=function(){this._nodes={};this._leaves={};var a=this._root.getElementsByTagName("*");for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.getAttribute("data-jsid");e&&(d.removeAttribute("data-jsid"),this._nodes[e]=d,this._leaves[e]=!d.childNodes.length)}};c.getRoot=function(){return this._root};c.getNode=function(a){return this._nodes[a]};c.setNodeProperty=function(a,b,c){this.getNode(a)[b]=c;return this};c.setNodeContent=function(a,c){if(!this._leaves[a])throw new Error("Can't setContent on non-leaf node: "+a);b("DOM").setContent(this.getNode(a),c);return this};return a}();e.exports=a}),null);
__d("legacy:CompactTypeaheadRenderer",["CompactTypeaheadRenderer"],(function(a,b,c,d,e,f){a.TypeaheadRenderers||(a.TypeaheadRenderers={}),a.TypeaheadRenderers.compact=b("CompactTypeaheadRenderer")}),3);
__d("VaultGridPhotoItem",["cx","invariant","ActorURI","Arbiter","AsyncRequest","CSS","DOM","Event","XStickerPhotoEditorController"],(function(a,b,c,d,e,f,g,h){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,c,d){__p&&__p();var e=this;this.$1=0;this.$2=c;this.$3=a;this.$4=d.fbid;this.$5=d.originalFBID;this.$6=d.userID;this.$7=!1;this.$8=this.$4===this.$5;this.$9=d.editButton;c=d.removeButton;this.$9&&(this.$6||h(0,5156),b("Event").listen(this.$9,"click",function(){return e.$10()}));c&&b("Event").listen(c,"click",function(){b("DOM").remove(e.$3),b("Arbiter").inform("multi-upload/image-removed/"+e.$2,e.$4)});d.usePhotoEditorTagging&&(this.$6||h(0,5157),this.$11(d.xyTags))}var c=a.prototype;c.setGridID=function(a){this.$2=a};c.$11=function(a){__p&&__p();var c=this;b("Arbiter").subscribe("AttachmentsPhotoEditor/tagStateChanged"+this.$4,function(a,d){c.$12(),b("CSS").conditionClass(c.$3,"_57vj",d)});if(!this.$8&&!this.$13(a)){this.$12();b("Arbiter").inform("AttachmentsPhotoEditor/tagsUpdated"+this.$2,{fbid:this.$4,xyTags:a});return}b("Arbiter").inform("AttachmentsPhotoEditor/requestFaceboxes"+this.$2,{fbid:this.$4,tags:a,shouldTransferFaceboxTags:!this.$8});b("CSS").addClass(this.$3,"_57vh");b("CSS").hide(this.$9)};c.$13=function(a){return a.some(function(a){return a.from_facebox})};c.$12=function(){if(this.$7)return;var a=b("DOM").find(this.$3,".fbVaultGridImage"),c=b("DOM").scry(this.$3,".fbVaultGridPhotoItemTagButton")[0];b("Event").listen(a,"click",this.$10.bind(this,"tag"));c&&b("Event").listen(c,"click",this.$10.bind(this,"tag"));b("CSS").removeClass(this.$3,"_57vh");b("CSS").show(this.$9);this.$7=!0};c.$10=function(a){__p&&__p();var c=this;if(this.$14)return;b("CSS").addClass(this.$3,"_57vh");var d=b("XStickerPhotoEditorController").getURIBuilder().setString("grid_id",this.$2).setEnum("target_type","composer").setInt("latest_fbid",this.$4).setInt("photo_fbid",this.$5||this.$4);a&&d.setEnum("initial_tab",a);a=b("ActorURI").create(d.getURI(),this.$6);this.$14=new(b("AsyncRequest"))(a).setFinallyHandler(function(){c.$14=null,b("CSS").removeClass(c.$3,"_57vh")});this.$14.send()};return a}();e.exports=a}),null);